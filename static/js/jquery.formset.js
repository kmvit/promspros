(function(b){b.fn.formset=function(e){var a=b.extend({},b.fn.formset.defaults,e),w=a.extraClasses.join(" "),h=b("#id_"+a.prefix+"-TOTAL_FORMS"),k=b("#id_"+a.prefix+"-MAX_NUM_FORMS"),m=b("#id_"+a.prefix+"-MIN_NUM_FORMS");e=b(this);var p=function(d,b){a.extraClasses&&(d.removeClass(w),d.addClass(a.extraClasses[b%a.extraClasses.length]))},q=function(a,b,c){var d=new RegExp(b+"-(\\d+|__prefix__)-");b=b+"-"+c+"-";a.attr("for")&&a.attr("for",a.attr("for").replace(d,b));a.attr("id")&&a.attr("id",a.attr("id").replace(d,
b));a.attr("name")&&a.attr("name",a.attr("name").replace(d,b))},r=function(){return 0==k.length||""==k.val()||0<k.val()-h.val()},t=function(){return 0==m.length||""==m.val()||0<h.val()-m.val()},u=function(d){var c=b.trim(a.deleteCssClass).replace(/\s+/g,"."),f=b.trim(a.addCssClass).replace(/\s+/g,".");d.is("TR")?d.children(":last").append('<a class="'+a.deleteCssClass+'" href="javascript:void(0)">'+a.deleteText+"</a>"):d.is("UL")||d.is("OL")?d.append('<li><a class="'+a.deleteCssClass+'" href="javascript:void(0)">'+
a.deleteText+"</a></li>"):d.append('<a class="'+a.deleteCssClass+'" href="javascript:void(0)">'+a.deleteText+"</a>");t()||d.find("a."+c).hide();d.find("a."+c).click(function(){var d=b(this).parents("."+a.formCssClass),n=d.find('input:hidden[id $= "-DELETE"]'),e=d.siblings("a."+f+", ."+a.formCssClass+"-add");if(n.length){n.val("on");d.hide();var l=b("."+a.formCssClass).not(":hidden")}else d.remove(),l=b("."+a.formCssClass).not(".formset-custom-template"),h.val(l.length);for(var g=0,k=l.length;g<k;g++)p(l.eq(g),
g),n.length||l.eq(g).find("input,select,textarea,label,div").each(function(){q(b(this),a.prefix,g)});t()||b("a."+c).each(function(){b(this).hide()});e.is(":hidden")&&r()&&e.show();a.removed&&a.removed(d);return!1})};e.each(function(d){var c=b(this),f=c.find('input:checkbox[id $= "-DELETE"]');f.length&&(f.is(":checked")?(f.before('<input type="hidden" name="'+f.attr("name")+'" id="'+f.attr("id")+'" value="on" />'),c.hide()):f.before('<input type="hidden" name="'+f.attr("name")+'" id="'+f.attr("id")+
'" />'),b('label[for="'+f.attr("id")+'"]').hide(),f.remove());0<c.find("input,select,textarea,label,div").length&&(c.addClass(a.formCssClass),c.is(":visible")&&(u(c),p(c,d)))});if(e.length){var v=!r();if(a.formTemplate){var c=a.formTemplate instanceof b?a.formTemplate:b(a.formTemplate);c.removeAttr("id").addClass(a.formCssClass+" formset-custom-template");c.find("input,select,textarea,label,div").each(function(){q(b(this),a.prefix,"__prefix__")});u(c)}else c=b("."+a.formCssClass+":last").clone(!0).removeAttr("id"),
c.find('input:hidden[id $= "-DELETE"]').remove(),c.find("input,select,textarea,label,div").not(a.keepFieldValues).each(function(){var a=b(this);a.is("input:checkbox")||a.is("input:radio")?a.attr("checked",!1):a.val("")});a.formTemplate=c;e.is("TR")?(c=e.eq(0).children().length,c=b('<tr><td colspan="'+c+'"><a class="'+a.addCssClass+'" href="javascript:void(0)">'+a.addText+"</a></tr>").addClass(a.formCssClass+"-add"),e.parent().append(c),v&&c.hide(),c=c.find("a")):(e.filter(":last").after('<a class="'+
a.addCssClass+'" href="javascript:void(0)">'+a.addText+"</a>"),c=e.filter(":last").next(),v&&c.hide());c.click(function(){var c=parseInt(h.val()),e=a.formTemplate.clone(!0).removeClass("formset-custom-template"),f=b(b(this).parents("tr."+a.formCssClass+"-add").get(0)||this);delCssSelector=b.trim(a.deleteCssClass).replace(/\s+/g,".");p(e,c);e.insertBefore(f).show();e.find("input,select,textarea,label,div").each(function(){q(b(this),a.prefix,c)});h.val(c+1);t()&&b("a."+delCssSelector).each(function(){b(this).show()});
r()||f.hide();a.added&&a.added(e);return!1})}return e};b.fn.formset.defaults={prefix:"form",formTemplate:null,addText:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0431\u043b\u043e\u043a",deleteText:"",addCssClass:"add-row",deleteCssClass:"delete-row",formCssClass:"dynamic-form",extraClasses:[],keepFieldValues:"",added:null,removed:null}})(jQuery);